<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Open World Fishing</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<style>
  html,body{margin:0;height:100%;overflow:hidden;background:#0b1220;font-family:Arial,Helvetica,sans-serif;color:#eaf6ff;}
  canvas{display:block;}
  #crosshair{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:20px;height:20px;border:2px solid #fff;border-radius:50%;pointer-events:none;}
  #hud{position:absolute;top:10px;left:10px;background:rgba(0,0,0,0.5);padding:10px 14px;border-radius:8px;font-size:14px;line-height:1.4;}
  #controls{position:absolute;bottom:10px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,0.5);padding:8px 12px;border-radius:8px;font-size:13px;}
  #message{position:absolute;top:40%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.7);padding:20px 30px;border-radius:12px;font-size:22px;display:none;}
  .bar{height:10px;background:rgba(255,255,255,0.1);border-radius:6px;overflow:hidden;margin-top:4px;}
  .bar>i{display:block;height:100%;background:linear-gradient(90deg,#5ee2ff,#2fa8ff);width:50%;}
</style>
</head>
<body>
<div id="crosshair"></div>
<div id="hud">
  <div>Biome: <span id="biome">Lake</span></div>
  <div>Time: <span id="timeOfDay">Day</span></div>
  <div>Stamina: <span id="stamina">100</span></div>
  <div>Score: <span id="score">0</span></div>
  <div class="bar"><i id="castBar" style="width:0%"></i></div>
</div>
<div id="controls">Click to lock pointer • WASD move • Mouse look • Left click cast/reel • R change lure</div>
<div id="message"></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script>
/* ================================
   Simple Open World Fishing Game
   ================================ */

const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75,innerWidth/innerHeight,0.1,2000);
camera.position.set(0,3,10);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
document.body.appendChild(renderer.domElement);

// Lights
const hemi = new THREE.HemisphereLight(0xffffbb,0x080820,1.0);
scene.add(hemi);

// Ground / water biomes
const ground = new THREE.Mesh(new THREE.PlaneGeometry(2000,2000),new THREE.MeshLambertMaterial({color:0x228b22}));
ground.rotation.x=-Math.PI/2;
scene.add(ground);

const water = new THREE.Mesh(new THREE.PlaneGeometry(2000,2000),new THREE.MeshLambertMaterial({color:0x1e90ff,transparent:true,opacity:0.8}));
water.rotation.x=-Math.PI/2;
water.position.y=-1;
scene.add(water);

// Random trees
for(let i=0;i<200;i++){
  const trunk=new THREE.Mesh(new THREE.CylinderGeometry(0.2,0.2,2),new THREE.MeshLambertMaterial({color:0x8b4513}));
  trunk.position.set((Math.random()-0.5)*1800,1,(Math.random()-0.5)*1800);
  const leaves=new THREE.Mesh(new THREE.ConeGeometry(2,4,8),new THREE.MeshLambertMaterial({color:0x006400}));
  leaves.position.set(trunk.position.x,3,trunk.position.z);
  scene.add(trunk,leaves);
}

// HUD elements
const biomeEl=document.getElementById("biome");
const timeEl=document.getElementById("timeOfDay");
const staminaEl=document.getElementById("stamina");
const scoreEl=document.getElementById("score");
const castBar=document.getElementById("castBar");
const msg=document.getElementById("message");

let score=0;
let stamina=100;
let casting=false;
let castPower=0;
let bobber=null;
let fishOn=false;
let time=0;

// Fish species
const fishSpecies=[
  {name:"Trout",biome:"Lake",points:20},
  {name:"Bass",biome:"Lake",points:30},
  {name:"Salmon",biome:"River",points:40},
  {name:"Catfish",biome:"River",points:25},
  {name:"Carp",biome:"Marsh",points:15},
  {name:"Pike",biome:"Marsh",points:35},
  {name:"Tuna",biome:"Ocean",points:60},
  {name:"Marlin",biome:"Ocean",points:100}
];

// Pointer lock + controls
let keys={};
document.body.addEventListener("click",()=>{document.body.requestPointerLock();});
document.addEventListener("mousemove",e=>{
  if(document.pointerLockElement===document.body){
    camera.rotation.y-=e.movementX*0.002;
    camera.rotation.x-=e.movementY*0.002;
    camera.rotation.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,camera.rotation.x));
  }
});
document.addEventListener("keydown",e=>keys[e.code]=true);
document.addEventListener("keyup",e=>keys[e.code]=false);

// Casting
document.addEventListener("mousedown",()=>{
  if(!bobber && !fishOn){casting=true;castPower=0;}
  else if(fishOn){reelFish();}
});
document.addEventListener("mouseup",()=>{
  if(casting){launchBobber();casting=false;}
});

// Reeling mechanic
function reelFish(){
  if(Math.random()<0.7){ // succeed chance
    let caught=pickFish();
    score+=caught.points;
    scoreEl.textContent=score;
    showMessage("You caught a "+caught.name+"! +"+caught.points);
  }else{
    showMessage("The fish got away!");
  }
  scene.remove(bobber);bobber=null;fishOn=false;
}

function launchBobber(){
  const dir=new THREE.Vector3(0,0,-1).applyEuler(camera.rotation).normalize();
  bobber=new THREE.Mesh(new THREE.SphereGeometry(0.2,8,8),new THREE.MeshBasicMaterial({color:0xff0000}));
  bobber.position.copy(camera.position).add(dir.clone().multiplyScalar(2));
  bobber.userData.vel=dir.multiplyScalar(castPower*0.3);
  scene.add(bobber);
}

// Pick random fish based on biome
function pickFish(){
  const biome=currentBiome();
  const options=fishSpecies.filter(f=>f.biome===biome);
  return options[Math.floor(Math.random()*options.length)];
}

// Which biome is player in?
function currentBiome(){
  const z=camera.position.z;
  if(z>200) return "Ocean";
  if(z<-200) return "River";
  if(camera.position.x>200) return "Marsh";
  return "Lake";
}

// Message
function showMessage(txt){
  msg.textContent=txt;
  msg.style.display="block";
  setTimeout(()=>{msg.style.display="none";},2000);
}

// Animate
function animate(){
  requestAnimationFrame(animate);

  // Movement
  const dir=new THREE.Vector3();
  if(keys["KeyW"]) dir.z-=1;
  if(keys["KeyS"]) dir.z+=1;
  if(keys["KeyA"]) dir.x-=1;
  if(keys["KeyD"]) dir.x+=1;
  dir.normalize();
  const move=new THREE.Vector3(dir.x,0,dir.z).applyEuler(camera.rotation);
  camera.position.addScaledVector(move,0.2);

  // Casting power
  if(casting){
    castPower=(castPower+1)%100;
    castBar.style.width=castPower+"%";
  }else{
    castBar.style.width="0%";
  }

  // Bobber physics
  if(bobber){
    bobber.position.add(bobber.userData.vel);
    bobber.userData.vel.multiplyScalar(0.95);
    bobber.position.y=Math.max(-0.5,bobber.position.y-0.02);
    if(!fishOn && Math.random()<0.002){fishOn=true;showMessage("Fish on! Click to reel!");}
  }

  // Time / day-night cycle
  time+=0.001;
  let dayPhase=Math.sin(time);
  scene.background=new THREE.Color(dayPhase>0?0x87ceeb:0x000022);
  timeEl.textContent=dayPhase>0?"Day":"Night";

  // HUD
  biomeEl.textContent=currentBiome();
  staminaEl.textContent=Math.floor(stamina);

  renderer.render(scene,camera);
}
animate();

window.addEventListener("resize",()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>
